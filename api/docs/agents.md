# 智能体系统

本文档介绍NativeAI项目的智能体系统架构和使用方法。

## 1. 概述

智能体系统基于LangGraph构建，实现了基于图的多节点工作流，支持自动工具选择和执行，适合处理复杂且多步骤的问题。

当前实现的智能体包括:
- 运费险助手：处理运费险相关的查询和咨询

## 2. 系统架构

智能体系统分为以下几个主要部分:

1. **智能体主控制器** - 负责理解用户输入并决定下一步行动
2. **工具模块** - 提供各种专门功能的工具
3. **图构建器** - 创建和管理工作流图结构
4. **会话管理** - 维护用户会话状态
5. **API端点** - 为前端提供接口

## 3. 运费险助手

运费险助手能够:
- 回答关于运费险的一般性问题
- 查询特定商品是否支持运费险
- 查询订单相关的售后单及其运费险状态
- 处理售后单的运费险咨询

### 3.1 使用的工具

- `ask_for_good` - 询问用户提供商品信息
- `ask_for_order` - 询问用户提供订单号
- `query_good_support` - 查询商品是否支持运费险
- `query_aftersales_by_order` - 查询订单的售后单
- `select_aftersale` - 查询特定售后单的运费险状态

### 3.2 工作流程

1. 用户发送查询
2. 智能体分析用户意图
3. 如需要，调用相关工具获取信息
4. 生成回复

## 4. API使用方法

### 4.1 创建新对话

```http
POST /api/agents/shipping-fee/chat
Content-Type: application/json

{
  "content": "我想了解运费险"
}
```

响应:
```json
{
  "reply": "运费险是一种为消费者提供的服务，可以保障您在退换货过程中产生的运费。如果您想查询特定商品是否支持运费险，请提供商品信息；如果想查询订单的运费险状态，请提供订单号。",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2023-07-01T12:34:56.789Z"
}
```

### 4.2 继续现有对话

```http
POST /api/agents/shipping-fee/chat
Content-Type: application/json

{
  "content": "我买的食品支持运费险吗？",
  "session_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 4.3 查看会话历史

```http
GET /api/agents/sessions/550e8400-e29b-41d4-a716-446655440000
```

### 4.4 删除会话

```http
DELETE /api/agents/sessions/550e8400-e29b-41d4-a716-446655440000
```

## 5. 配置参数

智能体系统的主要配置参数:

- `LLM_API_KEY` - 大模型API密钥
- `LLM_API_BASE` - API基础URL
- `LLM_MODEL_NAME` - 使用的模型名称
- `SESSION_TTL_SECONDS` - 会话保存时间(秒)
